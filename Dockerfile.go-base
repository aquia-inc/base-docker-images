FROM cgr.dev/chainguard/go:latest@sha256:da99a150cc0b122a55e9dff7e696407d2e76027502129fb56f5dabbd767d1bd7

# Trigger workflow with version extraction fix
USER nonroot
WORKDIR /workspace

# Extract Go version information and save to /tmp/versions.txt
SHELL ["/bin/sh", "-o", "pipefail", "-c"]
RUN go version > /tmp/go_version.txt && \
    GO_VERSION=$(go version | cut -d' ' -f3 | sed 's/go//') && \
    echo "go=${GO_VERSION}" > /tmp/versions.txt && \
    GO_MAJOR=$(echo "${GO_VERSION}" | cut -d'.' -f1) && \
    GO_MINOR="${GO_MAJOR}.$(echo "${GO_VERSION}" | cut -d'.' -f2)" && \
    echo "go_major_tag=${GO_MAJOR}" >> /tmp/versions.txt && \
    echo "go_minor_tag=${GO_MINOR}" >> /tmp/versions.txt && \
    cat /tmp/versions.txt
