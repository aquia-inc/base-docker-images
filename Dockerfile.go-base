FROM cgr.dev/chainguard/go:latest@sha256:f8bfc4830b8e268ab2cd5af6f5da67ef8252e8b3408e064326a8ec5d237e8810

USER nonroot
WORKDIR /workspace

# Extract Go version information and save to /tmp/versions.txt
SHELL ["/bin/sh", "-o", "pipefail", "-c"]
RUN go version > /tmp/go_version.txt && \
    GO_VERSION=$(go version | cut -d' ' -f3 | sed 's/go//') && \
    echo "go=${GO_VERSION}" > /tmp/versions.txt && \
    GO_MAJOR=$(echo "${GO_VERSION}" | cut -d'.' -f1) && \
    GO_MINOR="${GO_MAJOR}.$(echo "${GO_VERSION}" | cut -d'.' -f2)" && \
    echo "go_major_tag=${GO_MAJOR}" >> /tmp/versions.txt && \
    echo "go_minor_tag=${GO_MINOR}" >> /tmp/versions.txt && \
    cat /tmp/versions.txt
